!function(e){checkLog()||e.location.replace("./errlogin")}(window),function(f,e){f(e).ready(function(){f("#uploadbtn").click(function(e){e.preventDefault(),f.post("./createsprites/create",{creating:"sprites"},function(){console.log("post sent")}).done(function(e){"ok"!=e?console.log(e):setTimeout(function(){window.location="./spritescreated"},1e3)})}),f("#uploadfiles").val("").change();function c(e){this.file=e}var d=0;function u(e){var t=f(e).parent(),o=t.find(".imgname").html();t.remove(),f.ajax({type:"POST",url:"./createsprites/removeimg",data:{removePic:o},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function g(e){var t=f(e).parent(),o=t.find(".imgname").html(),n=o.split(".")[0],a=o.split(".")[1],i=prompt("Rename?",n);if(null!=i&&0<i.length){var s=i+"."+a;t.find(".imgname").html(s),f.ajax({type:"POST",url:"./createsprites/renameimg",data:{oldName:o,newName:s},success:function(e){console.log(e)},error:function(e){console.log(e)}})}}c.prototype.getType=function(){return this.file.type},c.prototype.getSize=function(){return this.file.size},c.prototype.getName=function(){return this.file.name},c.prototype.doUpload=function(){var n=this,e=new FormData;e.append("file",this.file,this.getName()),e.append("upload_file",!0),f.ajax({type:"POST",url:"./createsprites/upload",xhr:function(){var e=f.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",n.progressHandling,!1),e},success:function(e){var t=unescape(n.getName()).trim(),o=f("<img>",{attr:{alt:"",src:"./uploads/"+unescape(userNameCookie)+"/uploads/"+t}}).load(function(){console.log("Pic uploaded"),f(this).parent().find(".loading").fadeOut(300)});f(".upcont"+d+" .imgcont").append(o),console.log("Pic upload Complete!",d,e),d++},error:function(e){console.log(e)},async:!0,data:e,cache:!1,contentType:!1,processData:!1,timeout:6e3}).done(function(e){console.log(e)})},c.prototype.progressHandling=function(e){var t=0,o=e.loaded||e.position,n=e.total,a="#progress-wrp";e.lengthComputable&&(t=Math.ceil(o/n*100)),f(a+" .progress-bar").css("width",+t+"%"),f(a+" .status").text(t+"%")},f("#upload input").on("change",function(e){f("#progress-wrp .progress-bar").remove(),f("#progress-wrp").append('<div class="progress-bar"></div>'),f("#progress-wrp .status").text("0%");var t=f(this)[0].files;for(var o in t){new c(t[o]).doUpload()}for(var n=d,a=document.getElementById("uploadfiles"),i=d;i<a.files.length+n;i++){var s=i-d,r=f("<div>",{addClass:"upcont upcont"+i}),p=f("<div>",{addClass:"remove",click:function(){u(this)},attr:{title:"delete picture"}}),l=f("<div>",{addClass:"rename",click:function(){g(this)},html:"Rename"});r.append(p),r.append('<div class="imgcont"><div class="loading"><img src="./images/ajax-loader.gif" alt=""></div></div>'),r.append('<p class="imgname">'+a.files[s].name+"</p>"),r.append(l),r.append('<p class="imgtype">'+a.files[s].type+"</p>"),f("#uploaded").append(r)}})})}(jQuery,document);